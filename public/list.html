<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
  <link href="css/style.css" rel="stylesheet">
</head>
<body>
  <main id="contents">
    <header class="header-wrap">
      <a href="/index.html"><img src="/images/logo.svg"></a>
    </header>
    <section class="content">
      <ul class="post-list"></ul>
      <div class="oneul-container">
        <a href="javascript:;" onClick="postUpload()" class="oneul-btn">글쓰기</a>
      </div>
    </section>
    <footer class="footer-wrap">
      <div class="navigator">
        <a href="/index.html" class="nav-item home"><span class="nav-txt">홈</span></a>
        <a href="/search.html" class="nav-item search"><span class="nav-txt">검색</span></a>
        <a href="/list.html" class="nav-item community active"><span class="nav-txt">커뮤니티</span></a>
        <a href="/mypage.html" class="nav-item my-page"><span class="nav-txt">MY</span></a>
    </div>
    </footer>
  </main>


  <!-- 필수 호출 script -->
  <script src="https://www.gstatic.com/firebasejs/8.6.5/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.6.5/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.6.5/firebase-firestore.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.6.5/firebase-storage.js"></script>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script>
    const firebaseConfig = {
    apiKey: "AIzaSyBPwBvkUab2QHIgqTPODBIC8gWWowDohjM",
    authDomain: "oneul-9b3e4.firebaseapp.com",
    databaseURL: "https://oneul-9b3e4-default-rtdb.asia-southeast1.firebasedatabase.app",
    projectId: "oneul-9b3e4",
    storageBucket: "oneul-9b3e4.appspot.com",
    messagingSenderId: "993417131341",
    appId: "1:993417131341:web:ce271d5bffa75a7d42f304"
    };
    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
  </script>
  <!-- 필수 호출 script -->

  <script>
    const db = firebase.firestore();
 
    db.collection('post').get().then((result)=>{
        result.forEach((doc)=>{
            var 템플릿 = `<li class="post-list-item">
              <article class="post-wrap">
                  <a href="/view.html?id=${doc.id}" class="post-link"> 
                    <div class="post-item-top">
                      <p class="post-user">${doc.data().이름}</p>                
                      <p class="post-date">${doc.data().날짜.toDate().toLocaleString()}</p>
                    </div>                    
                    <h2 class="post-title">${doc.data().제목}</h2>
                    <p class="post-content">${doc.data().내용}</p>
                   
                  </a>
              </article>
          </li>`;
            $('.post-list').append(템플릿)
        })
    })

    function postUpload() {
      firebase.auth().onAuthStateChanged((user)=>{
        if (user) {
          window.location.href = "/upload.html";
        } else {
          alert('로그인 후 이용해주세요!!');
          window.location.href = "/login.html";
        }
      })
    }


  </script>
  
</body>
</html>